import{d as e,r as l,M as a,c as s,o,k as r,l as t,m as i,n,z as u,A as c,t as d,G as p,J as v,N as m,j as h,y as f,x as w,u as g,q as b}from"./vendor-DG3C2HZs.js";import{G as y}from"./GoogleSignIn-Btcg-XxU.js";import{a as k}from"./api-xqyKR9hB.js";import{_ as P}from"./index-CDvNi4Z9.js";const C={class:"register-view"},_={class:"container"},A={class:"register-container"},U={class:"user-type-selector"},G={class:"form-group profile-photo-upload"},x={class:"photo-upload-container"},I=["src"],R={key:1,class:"photo-placeholder"},X={class:"photo-upload-controls"},V={for:"photo-upload",class:"upload-btn"},j={key:0,class:"photo-error"},S={class:"form-group"},T={key:0,class:"error-message"},O={class:"form-group"},z={key:0,class:"error-message"},J={class:"form-group"},N={key:0,class:"error-message"},D={class:"form-group"},E={key:0,class:"error-message"},F={class:"form-group"},L={key:0,class:"error-message"},$={class:"form-group checkbox-group"},q={class:"checkbox-label"},M={key:0,class:"error-message"},B={class:"form-actions"},H=["disabled"],K={class:"social-login"},Q={class:"login-link"},W={key:0,class:"oauth-error-container"},Y={class:"oauth-error-card"},Z={class:"oauth-error-content"},ee={class:"error-details"},le=P(e({__name:"RegisterView",setup(e){const P=g(),le=l({name:"",email:"",phone:"",password:"",confirmPassword:"",userType:"worker",termsAccepted:!1}),ae=a({file:null,preview:"",error:""}),se=e=>{const l=e.target;if(!l.files||0===l.files.length)return;const a=l.files[0];if(!a.type.match("image.*"))return ae.error="Пожалуйста, выберите изображение",ae.file=null,void(ae.preview="");if(a.size>5242880)return ae.error="Размер файла не должен превышать 5МБ",ae.file=null,void(ae.preview="");ae.file=a,ae.error="";const s=new FileReader;s.onload=e=>{var l;ae.preview=null==(l=e.target)?void 0:l.result},s.readAsDataURL(a)},oe=()=>{ae.file=null,ae.preview="",ae.error=""},re=l({name:"",email:"",phone:"",password:"",confirmPassword:"",termsAccepted:""}),te=l(!1),ie="redirect_uri_mismatch"===new URLSearchParams(window.location.search).get("error"),ne=l(ie),ue=s((()=>window.location.origin)),ce=()=>{ne.value=!0},de=()=>{ne.value=!1},pe=l(!1);o((async()=>{try{await fetch("undefined/health"),pe.value=!0}catch(e){pe.value=!1}}));const ve=async()=>{var e,l;Object.keys(re.value).forEach((e=>{const l=e;re.value[l]=""}));let a=!0;if(le.value.name||(re.value.name="Пожалуйста, введите ваше имя",a=!1),le.value.email?/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(le.value.email)||(re.value.email="Пожалуйста, введите корректный email",a=!1):(re.value.email="Пожалуйста, введите email",a=!1),le.value.phone?/^\+?\d{10,13}$/.test(le.value.phone.replace(/\s/g,""))||(re.value.phone="Пожалуйста, введите корректный номер телефона",a=!1):(re.value.phone="Пожалуйста, введите номер телефона",a=!1),le.value.password?le.value.password.length<6&&(re.value.password="Пароль должен содержать минимум 6 символов",a=!1):(re.value.password="Пожалуйста, введите пароль",a=!1),le.value.password!==le.value.confirmPassword&&(re.value.confirmPassword="Пароли не совпадают",a=!1),le.value.termsAccepted||(re.value.termsAccepted="Пожалуйста, примите пользовательское соглашение",a=!1),a)if(te.value=!0,pe.value)try{let e="";ae.preview&&(e=ae.preview);const l=await k.register({name:le.value.name,email:le.value.email,phone:le.value.phone,password:le.value.password,userType:le.value.userType,photo:e}),a={...l.data.user,token:l.data.token};localStorage.setItem("user",JSON.stringify(a)),te.value=!1,P.push("/")}catch(s){te.value=!1,(null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.error)?re.value.email=s.response.data.error:re.value.email="Ошибка регистрации"}else te.value=!1,re.value.email="Регистрация недоступна в демо-режиме. Используйте тестовые аккаунты."},me=e=>{le.value.userType=e};return(e,l)=>{const a=w("router-link");return b(),r("div",C,[t("div",_,[t("div",A,[l[35]||(l[35]=t("div",{class:"register-header"},[t("h1",null,"Регистрация"),t("p",null,"Создайте учетную запись для доступа к вакансиям")],-1)),t("div",U,[t("button",{class:n(["user-type-btn",{active:"worker"===le.value.userType}]),onClick:l[0]||(l[0]=e=>me("worker"))}," Я ищу работу ",2),t("button",{class:n(["user-type-btn",{active:"employer"===le.value.userType}]),onClick:l[1]||(l[1]=e=>me("employer"))}," Я ищу работников ",2)]),t("form",{onSubmit:u(ve,["prevent"]),class:"register-form"},[t("div",G,[l[12]||(l[12]=t("label",null,"Фото профиля",-1)),t("div",x,[t("div",{class:n(["photo-preview",{"has-photo":ae.preview}])},[ae.preview?(b(),r("img",{key:0,src:ae.preview,alt:"Profile Preview"},null,8,I)):(b(),r("div",R,l[8]||(l[8]=[t("i",{class:"fas fa-user"},null,-1)]))),ae.preview?(b(),r("button",{key:2,type:"button",class:"remove-photo",onClick:oe},l[9]||(l[9]=[t("i",{class:"fas fa-times"},null,-1)]))):i("",!0)],2),t("div",X,[t("label",V,[l[10]||(l[10]=t("i",{class:"fas fa-camera"},null,-1)),c(" "+d(ae.preview?"Изменить фото":"Загрузить фото"),1)]),t("input",{type:"file",id:"photo-upload",accept:"image/*",onChange:se,class:"photo-input"},null,32),l[11]||(l[11]=t("p",{class:"photo-hint"},"JPG, PNG, GIF. Макс. размер 5МБ",-1)),ae.error?(b(),r("div",j,d(ae.error),1)):i("",!0)])])]),t("div",S,[l[13]||(l[13]=t("label",{for:"name"},"Имя",-1)),p(t("input",{type:"text",id:"name","onUpdate:modelValue":l[2]||(l[2]=e=>le.value.name=e),class:n(["form-control",{"has-error":re.value.name}]),placeholder:"Введите ваше имя"},null,2),[[v,le.value.name]]),re.value.name?(b(),r("div",T,d(re.value.name),1)):i("",!0)]),t("div",O,[l[14]||(l[14]=t("label",{for:"email"},"Email",-1)),p(t("input",{type:"email",id:"email","onUpdate:modelValue":l[3]||(l[3]=e=>le.value.email=e),class:n(["form-control",{"has-error":re.value.email}]),placeholder:"Введите ваш email"},null,2),[[v,le.value.email]]),re.value.email?(b(),r("div",z,d(re.value.email),1)):i("",!0)]),t("div",J,[l[15]||(l[15]=t("label",{for:"phone"},"Телефон",-1)),p(t("input",{type:"tel",id:"phone","onUpdate:modelValue":l[4]||(l[4]=e=>le.value.phone=e),class:n(["form-control",{"has-error":re.value.phone}]),placeholder:"+996 XXX XXXXXX"},null,2),[[v,le.value.phone]]),re.value.phone?(b(),r("div",N,d(re.value.phone),1)):i("",!0)]),t("div",D,[l[16]||(l[16]=t("label",{for:"password"},"Пароль",-1)),p(t("input",{type:"password",id:"password","onUpdate:modelValue":l[5]||(l[5]=e=>le.value.password=e),class:n(["form-control",{"has-error":re.value.password}]),placeholder:"Минимум 6 символов"},null,2),[[v,le.value.password]]),re.value.password?(b(),r("div",E,d(re.value.password),1)):i("",!0)]),t("div",F,[l[17]||(l[17]=t("label",{for:"confirmPassword"},"Подтверждение пароля",-1)),p(t("input",{type:"password",id:"confirmPassword","onUpdate:modelValue":l[6]||(l[6]=e=>le.value.confirmPassword=e),class:n(["form-control",{"has-error":re.value.confirmPassword}]),placeholder:"Повторите пароль"},null,2),[[v,le.value.confirmPassword]]),re.value.confirmPassword?(b(),r("div",L,d(re.value.confirmPassword),1)):i("",!0)]),t("div",$,[t("label",q,[p(t("input",{type:"checkbox","onUpdate:modelValue":l[7]||(l[7]=e=>le.value.termsAccepted=e)},null,512),[[m,le.value.termsAccepted]]),l[18]||(l[18]=t("span",{class:"checkbox-text"},[c(" Я согласен с "),t("a",{href:"#",class:"terms-link"},"условиями использования"),c(" и "),t("a",{href:"#",class:"terms-link"},"политикой конфиденциальности")],-1))]),re.value.termsAccepted?(b(),r("div",M,d(re.value.termsAccepted),1)):i("",!0)]),t("div",B,[t("button",{type:"submit",class:"btn btn-primary",disabled:te.value},d(te.value?"Регистрация...":"Зарегистрироваться"),9,H)]),t("div",K,[l[19]||(l[19]=t("div",{class:"divider"},[t("span",null,"или")],-1)),h(y,{isRegister:!0})]),t("div",Q,[l[21]||(l[21]=c(" Уже есть аккаунт? ")),h(a,{to:"/login"},{default:f((()=>l[20]||(l[20]=[c("Войти")]))),_:1,__:[20]})])],32),ne.value?(b(),r("div",W,[t("div",Y,[t("div",{class:"oauth-error-header"},[l[22]||(l[22]=t("h3",null,"Ошибка настройки Google OAuth",-1)),t("button",{class:"close-btn",onClick:de},"×")]),t("div",Z,[l[32]||(l[32]=t("p",null,[t("strong",null,"Проблема:"),c(' Ошибка "redirect_uri_mismatch" возникает, когда URI перенаправления не настроен корректно в Google Cloud Console. ')],-1)),t("div",ee,[t("p",null,[l[23]||(l[23]=c(" Текущий URI перенаправления: ")),t("code",null,d(ue.value),1)])]),l[33]||(l[33]=t("h4",null,"Шаги для исправления:",-1)),t("ol",null,[l[25]||(l[25]=t("li",null,[c(" Откройте "),t("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank"},"Google Cloud Console")],-1)),l[26]||(l[26]=t("li",null,"Найдите и выберите ваш проект",-1)),l[27]||(l[27]=t("li",null,'Перейдите в раздел "Credentials" (Учетные данные)',-1)),l[28]||(l[28]=t("li",null,"Найдите и отредактируйте ваш OAuth 2.0 Client ID",-1)),t("li",null,[l[24]||(l[24]=c(' В разделе "Authorized redirect URIs" добавьте следующие URI: ')),t("ul",null,[t("li",null,[t("code",null,d(ue.value),1)]),t("li",null,[t("code",null,d(ue.value)+"/",1)]),t("li",null,[t("code",null,d(ue.value)+"/login",1)]),t("li",null,[t("code",null,d(ue.value)+"/register",1)]),t("li",null,[t("code",null,d(ue.value)+"/dashboard",1)])])]),l[29]||(l[29]=t("li",null,'Нажмите "Save" (Сохранить)',-1)),l[30]||(l[30]=t("li",null,"Изменения могут вступить в силу через несколько минут",-1))]),l[34]||(l[34]=t("p",{class:"note"}," Примечание: Если вы используете локальную разработку, также добавьте URIs для других портов (например, http://localhost:3000, http://localhost:5173 и т.д.) ",-1)),t("div",{class:"oauth-error-actions"},[t("button",{class:"btn btn-primary",onClick:de}," Понятно "),l[31]||(l[31]=t("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank",class:"btn btn-outline"},"Открыть Google Cloud Console",-1))])])])])):i("",!0),t("div",{class:"oauth-help"},[t("button",{class:"text-link",onClick:ce}," Проблемы с регистрацией через Google? Нажмите здесь ")])])])])}}}),[["__scopeId","data-v-f05b5456"]]);export{le as default};
