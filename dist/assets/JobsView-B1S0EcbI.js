import{d as e,r as a,c as l,o,w as t,k as s,l as r,m as n,t as c,v as u,G as i,J as v,F as d,p,n as m,A as y,I as g,z as b,K as h,q as f}from"./vendor-DG3C2HZs.js";import{J as j}from"./JobCard-C2pC7D9y.js";import{u as k,_ as w}from"./index-CDvNi4Z9.js";import{j as J}from"./api-xqyKR9hB.js";const S={class:"jobs-view"},I={class:"container"},x={class:"jobs-header"},V={class:"text-center"},U={class:"text-center subtitle"},C={class:"search-section"},O={class:"search-container"},E=["placeholder"],_={class:"categories-section"},$={class:"categories-wrapper"},D=["onClick"],P={key:0,class:"jobs-actions"},A={class:"jobs-results"},B={key:0,class:"text-center py-5"},T={key:1,class:"text-center text-danger py-5"},L={key:2},q={class:"jobs-filter-info"},M={class:"jobs-count"},N={key:0,class:"active-filters"},z={key:0,class:"filter-tag"},F={key:1,class:"filter-tag"},G={class:"jobs-grid"},K={key:0,class:"no-jobs"},Q={key:0,class:"modal-overlay"},H={class:"modal"},R={class:"form-group"},W={key:0,class:"error-message"},X={class:"form-group"},Y={key:0,class:"error-message"},Z={class:"form-group"},ee=["placeholder"],ae={key:0,class:"error-message"},le={class:"form-group"},oe=["placeholder"],te={key:0,class:"error-message"},se={class:"form-group"},re=["placeholder"],ne={key:0,class:"error-message"},ce={class:"form-group"},ue=["value"],ie={key:0,class:"error-message"},ve={class:"form-group"},de={class:"modal-actions"},pe={type:"submit",class:"btn btn-primary"},me={key:1,class:"modal-overlay"},ye={class:"modal"},ge={class:"form-group"},be={key:0,class:"error-message"},he={class:"form-group"},fe={key:0,class:"error-message"},je={class:"form-group"},ke=["placeholder"],we={key:0,class:"error-message"},Je={class:"form-group"},Se=["placeholder"],Ie={key:0,class:"error-message"},xe={class:"form-group"},Ve=["placeholder"],Ue={key:0,class:"error-message"},Ce={class:"form-group"},Oe=["value"],Ee={key:0,class:"error-message"},_e={class:"form-group"},$e={class:"modal-actions"},De={type:"submit",class:"btn btn-primary"},Pe=w(e({__name:"JobsView",setup(e){const{t:w,locale:Pe}=k(),Ae=a([]),Be=a(!0),Te=a("");async function Le(){Be.value=!0,Te.value="";try{console.log("Вызываем API для получения вакансий...");const e=await J.getJobs();console.log("Получен ответ от API:",e),Array.isArray(e)?(Ae.value=e,console.log(`Загружено ${Ae.value.length} вакансий`)):(console.error("Неверный формат данных:",e),Te.value="Неверный формат данных от сервера",Ae.value=[{id:1,title:"Демо вакансия",description:"Это демо-вакансия, созданная из-за ошибки загрузки",salary:"1000 сом",location:"Бишкек",phone:"+996 555 123456",date:(new Date).toISOString(),category:"Разное",requirements:["Демо-требование"],employer:"Демо-работодатель",urgency:"medium",employment_type:"part-time",user_id:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}])}catch(e){console.error("Ошибка при загрузке вакансий:",e),Te.value=`Ошибка при загрузке вакансий: ${e.message||"Неизвестная ошибка"}`,Ae.value=[{id:1,title:"Демо вакансия при ошибке",description:"Это демо-вакансия, созданная из-за ошибки загрузки",salary:"1000 сом",location:"Бишкек",phone:"+996 555 123456",date:(new Date).toISOString(),category:"Разное",requirements:["Демо-требование"],employer:"Демо-работодатель",urgency:"medium",employment_type:"part-time",user_id:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]}finally{Be.value=!1}}const qe=["all","cleaning","construction","delivery","repair","nanny","other"],Me=a(qe.map((e=>w(`categories.${e}`)))),Ne=l((()=>{const e=new Map;return qe.forEach((a=>{e.set(w(`categories.${a}`),a)})),e})),ze=l((()=>{const e=new Map;return qe.forEach((a=>{e.set(a,w(`categories.${a}`))})),e})),Fe=a(w("categories.all")),Ge=a(""),Ke=a(!1),Qe=a(""),He=a(!1),Re=a(!1),We=a(null),Xe=a({id:null,title:"",description:"",salary:"",location:"",phone:"",category:w("categories.other"),date:(new Date).toISOString().split("T")[0]}),Ye=a({id:null,title:"",description:"",salary:"",location:"",phone:"",category:w("categories.other"),date:""}),Ze=a({title:"",description:"",salary:"",location:"",phone:"",category:""}),ea=a({title:"",description:"",salary:"",location:"",phone:"",category:""}),aa=a("");o((async()=>{const e=localStorage.getItem("user");if(e)try{const a=JSON.parse(e);console.log("Пользователь авторизован:",a),Ke.value=!0,Qe.value=a.userType||"worker",console.log("Тип пользователя:",Qe.value),a.phone&&(Xe.value.phone=a.phone)}catch(a){console.error("Ошибка при парсинге данных пользователя:",a)}else console.log("Пользователь не авторизован");console.log("Загружаем вакансии..."),await Le(),console.log("Загружено вакансий:",Ae.value.length),Ae.value.length>0&&console.log("Пример вакансии:",Ae.value[0])})),t(Pe,(()=>{if(Me.value=qe.map((e=>w(`categories.${e}`))),Fe.value!==w("categories.all")){const e=Fe.value,a=Ne.value.get(e);Fe.value=w(a?`categories.${a}`:"categories.all")}else Fe.value=w("categories.all")}));const la=l((()=>Ae.value.filter((e=>{if(Fe.value!==w("categories.all")&&ze.value.get(e.category)!==Fe.value)return!1;if(Ge.value){const a=Ge.value.toLowerCase();return e.title.toLowerCase().includes(a)||e.description.toLowerCase().includes(a)||e.location.toLowerCase().includes(a)}return!0}))));function oa(e){Fe.value=e}function ta(){Fe.value=w("categories.all"),Ge.value=""}const sa=()=>{He.value=!0,Re.value=!1,Object.keys(Ze.value).forEach((e=>Ze.value[e]="")),Xe.value.date=(new Date).toISOString().split("T")[0];const e=localStorage.getItem("user");if(e)try{const a=JSON.parse(e);a.phone&&(Xe.value.phone=a.phone)}catch(a){console.error("Ошибка при получении данных пользователя",a)}},ra=()=>{He.value=!1},na=async()=>{let e=!0;if(Object.keys(Ze.value).forEach((e=>Ze.value[e]="")),Xe.value.title||(Ze.value.title="Введите название",e=!1),Xe.value.description||(Ze.value.description="Введите описание",e=!1),Xe.value.salary||(Ze.value.salary="Введите зарплату",e=!1),Xe.value.location||(Ze.value.location="Введите локацию",e=!1),Xe.value.phone||(Ze.value.phone="Введите телефон",e=!1),Xe.value.category||(Ze.value.category="Выберите категорию",e=!1),e)try{const e=await J.createJob({...Xe.value,id:void 0});if(e.message)throw new Error(e.message);He.value=!1,await Le()}catch(a){Te.value=a.message||"Ошибка при добавлении вакансии"}},ca=e=>{console.log("openEditJobModal вызван с job:",e),He.value=!1,Re.value=!0,Object.keys(ea.value).forEach((e=>ea.value[e]=""));const{applications:a,...l}=e;Ye.value={id:e.id,title:e.title,description:e.description,salary:e.salary,location:e.location,phone:e.phone,category:e.category,date:e.date},We.value=e.id,console.log("editJob.value после заполнения:",Ye.value),console.log("currentJobId.value после заполнения:",We.value)},ua=()=>{Re.value=!1,We.value=null},ia=async()=>{let e=!0;if(Object.keys(ea.value).forEach((e=>ea.value[e]="")),Ye.value.title||(ea.value.title="Введите название",e=!1),Ye.value.description||(ea.value.description="Введите описание",e=!1),Ye.value.salary||(ea.value.salary="Введите зарплату",e=!1),Ye.value.location||(ea.value.location="Введите локацию",e=!1),Ye.value.phone||(ea.value.phone="Введите телефон",e=!1),Ye.value.category||(ea.value.category="Выберите категорию",e=!1),e)try{const{id:e,...a}=Ye.value,l=null===e?{...a}:{...Ye.value,id:e},o=await J.updateJob(We.value,l);if(o.message)throw new Error(o.message);Re.value=!1,We.value=null,await Le()}catch(a){Te.value=a.message||"Ошибка при редактировании вакансии"}},va=async e=>{console.log("handleDeleteJob вызван с jobId:",e);try{const a=await J.deleteJob(e);if(a.message)throw new Error(a.message);await Le()}catch(a){Te.value=a.message||"Ошибка при удалении вакансии"}},da=async e=>{if(aa.value="",Ke.value)if("worker"===Qe.value)try{const a=await J.apply(e.id);a.message?(aa.value=a.message,alert(a.message)):(aa.value="Вы успешно откликнулись!",alert("Вы успешно откликнулись!"))}catch(a){aa.value="Ошибка при отклике",alert("Ошибка при отклике")}else alert("Только работники могут откликаться на вакансию");else alert("Для отклика на вакансию необходимо авторизоваться")};return(e,a)=>(f(),s("div",S,[r("div",I,[r("section",x,[r("h1",V,c(u(w)("jobs.header.title")),1),r("p",U,c(u(w)("jobs.header.subtitle")),1),r("div",C,[r("div",O,[i(r("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>Ge.value=e),placeholder:u(w)("jobs.search.placeholder"),class:"search-input"},null,8,E),[[v,Ge.value]]),a[17]||(a[17]=r("button",{class:"search-button"},[r("i",{class:"fas fa-search"})],-1))])]),r("div",_,[r("div",$,[(f(!0),s(d,null,p(Me.value,(e=>(f(),s("button",{key:e,class:m(["category-btn",{active:Fe.value===e}]),onClick:a=>oa(e)},c(e),11,D)))),128))])]),Ke.value&&"employer"===Qe.value?(f(),s("div",P,[r("button",{onClick:sa,class:"btn btn-primary add-job-btn"},[a[18]||(a[18]=r("i",{class:"fas fa-plus"},null,-1)),y(" "+c(u(w)("jobs.actions.addJob")),1)])])):n("",!0)]),r("section",A,[Be.value?(f(),s("div",B,"Загрузка...")):Te.value?(f(),s("div",T,c(Te.value),1)):(f(),s("div",L,[r("div",q,[r("span",M,c(u(w)("jobs.filterInfo.jobsCount"))+": "+c(la.value.length),1),Fe.value!==u(w)("categories.all")||Ge.value?(f(),s("div",N,[Fe.value!==u(w)("categories.all")?(f(),s("div",z,[y(c(Fe.value)+" ",1),r("button",{class:"clear-filter",onClick:a[1]||(a[1]=e=>oa(u(w)("categories.all")))},"×")])):n("",!0),Ge.value?(f(),s("div",F,[y(c(u(w)("jobs.filterInfo.searchQuery"))+": "+c(Ge.value)+" ",1),r("button",{class:"clear-filter",onClick:a[2]||(a[2]=e=>Ge.value="")},"×")])):n("",!0)])):n("",!0)]),r("div",G,[(f(!0),s(d,null,p(la.value,(e=>(f(),g(j,{key:e.id,job:e,isEmployer:Ke.value&&"employer"===Qe.value,onEdit:ca,onDelete:va,onApply:da},null,8,["job","isEmployer"])))),128))]),0===la.value.length?(f(),s("div",K,[a[19]||(a[19]=r("i",{class:"fas fa-search job-icon"},null,-1)),r("h3",null,c(u(w)("jobs.noJobs.title")),1),r("p",null,[y(c(u(w)("jobs.noJobs.text"))+" ",1),r("button",{class:"reset-btn",onClick:ta},c(u(w)("jobs.noJobs.resetBtn")),1)])])):n("",!0)]))])]),He.value?(f(),s("div",Q,[r("div",H,[r("h2",null,c(u(w)("jobs.modal.addJobTitle")),1),r("form",{onSubmit:b(na,["prevent"])},[r("div",R,[r("label",null,c(u(w)("jobs.form.title"))+" *",1),i(r("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>Xe.value.title=e),class:m(["form-control",{"has-error":Ze.value.title}])},null,2),[[v,Xe.value.title]]),Ze.value.title?(f(),s("div",W,c(Ze.value.title),1)):n("",!0)]),r("div",X,[r("label",null,c(u(w)("jobs.form.description"))+" *",1),i(r("textarea",{"onUpdate:modelValue":a[4]||(a[4]=e=>Xe.value.description=e),class:m(["form-control",{"has-error":Ze.value.description}]),rows:"4"},null,2),[[v,Xe.value.description]]),Ze.value.description?(f(),s("div",Y,c(Ze.value.description),1)):n("",!0)]),r("div",Z,[r("label",null,c(u(w)("jobs.form.salary"))+" *",1),i(r("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>Xe.value.salary=e),class:m(["form-control",{"has-error":Ze.value.salary}]),placeholder:u(w)("jobs.form.salaryPlaceholder")},null,10,ee),[[v,Xe.value.salary]]),Ze.value.salary?(f(),s("div",ae,c(Ze.value.salary),1)):n("",!0)]),r("div",le,[r("label",null,c(u(w)("jobs.form.location"))+" *",1),i(r("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=e=>Xe.value.location=e),class:m(["form-control",{"has-error":Ze.value.location}]),placeholder:u(w)("jobs.form.locationPlaceholder")},null,10,oe),[[v,Xe.value.location]]),Ze.value.location?(f(),s("div",te,c(Ze.value.location),1)):n("",!0)]),r("div",se,[r("label",null,c(u(w)("jobs.form.phone"))+" *",1),i(r("input",{type:"tel","onUpdate:modelValue":a[7]||(a[7]=e=>Xe.value.phone=e),class:m(["form-control",{"has-error":Ze.value.phone}]),placeholder:u(w)("jobs.form.phonePlaceholder")},null,10,re),[[v,Xe.value.phone]]),Ze.value.phone?(f(),s("div",ne,c(Ze.value.phone),1)):n("",!0)]),r("div",ce,[r("label",null,c(u(w)("jobs.form.category"))+" *",1),i(r("select",{"onUpdate:modelValue":a[8]||(a[8]=e=>Xe.value.category=e),class:m(["form-control",{"has-error":Ze.value.category}])},[(f(!0),s(d,null,p(qe.filter((e=>"all"!==e)),(e=>(f(),s("option",{key:e,value:u(w)(`categories.${e}`)},c(u(w)(`categories.${e}`)),9,ue)))),128))],2),[[h,Xe.value.category]]),Ze.value.category?(f(),s("div",ie,c(Ze.value.category),1)):n("",!0)]),r("div",ve,[r("label",null,c(u(w)("jobs.form.date"))+" *",1),i(r("input",{type:"date","onUpdate:modelValue":a[9]||(a[9]=e=>Xe.value.date=e),class:"form-control"},null,512),[[v,Xe.value.date]])]),r("div",de,[r("button",pe,c(u(w)("jobs.modal.addJobBtn")),1),r("button",{type:"button",class:"btn btn-outline",onClick:ra},c(u(w)("jobs.modal.cancelBtn")),1)])],32)])])):n("",!0),Re.value?(f(),s("div",me,[r("div",ye,[r("h2",null,c(u(w)("jobs.modal.editJobTitle")),1),r("form",{onSubmit:b(ia,["prevent"])},[r("div",ge,[r("label",null,c(u(w)("jobs.form.title"))+" *",1),i(r("input",{type:"text","onUpdate:modelValue":a[10]||(a[10]=e=>Ye.value.title=e),class:m(["form-control",{"has-error":ea.value.title}])},null,2),[[v,Ye.value.title]]),ea.value.title?(f(),s("div",be,c(ea.value.title),1)):n("",!0)]),r("div",he,[r("label",null,c(u(w)("jobs.form.description"))+" *",1),i(r("textarea",{"onUpdate:modelValue":a[11]||(a[11]=e=>Ye.value.description=e),class:m(["form-control",{"has-error":ea.value.description}]),rows:"4"},null,2),[[v,Ye.value.description]]),ea.value.description?(f(),s("div",fe,c(ea.value.description),1)):n("",!0)]),r("div",je,[r("label",null,c(u(w)("jobs.form.salary"))+" *",1),i(r("input",{type:"text","onUpdate:modelValue":a[12]||(a[12]=e=>Ye.value.salary=e),class:m(["form-control",{"has-error":ea.value.salary}]),placeholder:u(w)("jobs.form.salaryPlaceholder")},null,10,ke),[[v,Ye.value.salary]]),ea.value.salary?(f(),s("div",we,c(ea.value.salary),1)):n("",!0)]),r("div",Je,[r("label",null,c(u(w)("jobs.form.location"))+" *",1),i(r("input",{type:"text","onUpdate:modelValue":a[13]||(a[13]=e=>Ye.value.location=e),class:m(["form-control",{"has-error":ea.value.location}]),placeholder:u(w)("jobs.form.locationPlaceholder")},null,10,Se),[[v,Ye.value.location]]),ea.value.location?(f(),s("div",Ie,c(ea.value.location),1)):n("",!0)]),r("div",xe,[r("label",null,c(u(w)("jobs.form.phone"))+" *",1),i(r("input",{type:"tel","onUpdate:modelValue":a[14]||(a[14]=e=>Ye.value.phone=e),class:m(["form-control",{"has-error":ea.value.phone}]),placeholder:u(w)("jobs.form.phonePlaceholder")},null,10,Ve),[[v,Ye.value.phone]]),ea.value.phone?(f(),s("div",Ue,c(ea.value.phone),1)):n("",!0)]),r("div",Ce,[r("label",null,c(u(w)("jobs.form.category"))+" *",1),i(r("select",{"onUpdate:modelValue":a[15]||(a[15]=e=>Ye.value.category=e),class:m(["form-control",{"has-error":ea.value.category}])},[(f(!0),s(d,null,p(qe.filter((e=>"all"!==e)),(e=>(f(),s("option",{key:e,value:u(w)(`categories.${e}`)},c(u(w)(`categories.${e}`)),9,Oe)))),128))],2),[[h,Ye.value.category]]),ea.value.category?(f(),s("div",Ee,c(ea.value.category),1)):n("",!0)]),r("div",_e,[r("label",null,c(u(w)("jobs.form.date"))+" *",1),i(r("input",{type:"date","onUpdate:modelValue":a[16]||(a[16]=e=>Ye.value.date=e),class:"form-control"},null,512),[[v,Ye.value.date]])]),r("div",$e,[r("button",De,c(u(w)("jobs.modal.editJobBtn")),1),r("button",{type:"button",class:"btn btn-outline",onClick:ua},c(u(w)("jobs.modal.cancelBtn")),1)])],32)])])):n("",!0)]))}}),[["__scopeId","data-v-4d0a4e2d"]]);export{Pe as default};
